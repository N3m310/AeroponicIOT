<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luật tự động hóa - Smart Farm IoT</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/automation.css">
</head>
<body>
    <header>
        <h1>⚙️ Luật tự động hóa</h1>
        <div class="header-controls">
            <div id="automationHeader"></div>
        </div>
    </header>

    <main class="automation-container">
        <!-- New Rule Section -->
        <section class="card new-rule-section">
            <h2>Tạo luật mới</h2>
            <form id="newRuleForm" class="rule-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="ruleName">Tên luật:</label>
                        <input type="text" id="ruleName" placeholder="ví dụ: Tưới buổi sáng" required>
                    </div>
                    <div class="form-group">
                        <label for="deviceSelect">Thiết bị:</label>
                        <select id="deviceSelect" required>
                            <option value="">Đang tải...</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="ruleType">Loại luật:</label>
                        <select id="ruleType" onchange="updateRuleTypeFields()" required>
                            <option value="">Chọn loại</option>
                            <option value="0">Lịch trình (theo thời gian)</option>
                            <option value="1">Ngưỡng (theo cảm biến)</option>
                            <option value="2">Hẹn giờ (thời lượng cố định)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="actuatorType">Thiết bị chấp hành:</label>
                        <select id="actuatorType" required>
                            <option value="">Chọn thiết bị</option>
                            <option value="0">Bơm</option>
                            <option value="1">Quạt</option>
                            <option value="2">Đèn</option>
                            <option value="3">Sưởi</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="action">Hành động:</label>
                        <select id="action" required>
                            <option value="ON">Bật</option>
                            <option value="OFF">Tắt</option>
                            <option value="PULSE">Nhấp nháy (1 phút bật/tắt)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="priority">Ưu tiên (1-10):</label>
                        <input type="number" id="priority" min="1" max="10" value="5" required>
                    </div>
                </div>

                <!-- Schedule Fields -->
                <div id="scheduleFields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="scheduleTime">Thời gian trong ngày:</label>
                            <input type="time" id="scheduleTime">
                        </div>
                        <div class="form-group">
                            <label for="durationMinutes">Thời lượng (phút):</label>
                            <input type="number" id="durationMinutes" min="1" max="1440">
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label>Lặp vào:</label>
                        <div class="days-select">
                            <label><input type="checkbox" name="days" value="Monday"> Thứ Hai</label>
                            <label><input type="checkbox" name="days" value="Tuesday"> Thứ Ba</label>
                            <label><input type="checkbox" name="days" value="Wednesday"> Thứ Tư</label>
                            <label><input type="checkbox" name="days" value="Thursday"> Thứ Năm</label>
                            <label><input type="checkbox" name="days" value="Friday"> Thứ Sáu</label>
                            <label><input type="checkbox" name="days" value="Saturday"> Thứ Bảy</label>
                            <label><input type="checkbox" name="days" value="Sunday"> Chủ Nhật</label>
                        </div>
                    </div>
                </div>

                <!-- Threshold Fields -->
                <div id="thresholdFields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conditionParameter">Khi thông số:</label>
                            <select id="conditionParameter">
                                <option value="pH">pH</option>
                                <option value="TDS">TDS (Dinh dưỡng)</option>
                                <option value="Temperature">Nhiệt độ nước</option>
                                <option value="Humidity">Độ ẩm không khí</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conditionOperator">Điều kiện:</label>
                            <select id="conditionOperator">
                                <option value=">">&gt; (Lớn hơn)</option>
                                <option value="<">&lt; (Nhỏ hơn)</option>
                                <option value=">=">&gt;= (Lớn hơn hoặc bằng)</option>
                                <option value="<=">&lt;= (Nhỏ hơn hoặc bằng)</option>
                                <option value="==">=</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conditionValue">Giá trị:</label>
                            <input type="number" id="conditionValue" placeholder="6.5" step="0.1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="durationMinutes2">Thời lượng (phút):</label>
                            <input type="number" id="durationMinutes2" min="1" max="1440" placeholder="30">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <button type="submit" class="btn-primary" style="width: 100%;">➕ Tạo luật</button>
                </div>
            </form>
        </section>

        <!-- Active Rules Section -->
        <section class="card rules-section">
            <h2>Luật đang hoạt động</h2>
            <div id="activeRulesList" class="rules-list">
                <p>Đang tải luật...</p>
            </div>
        </section>

        <!-- Inactive Rules Section -->
        <section class="card inactive-section">
            <h2>Luật không hoạt động</h2>
            <div id="inactiveRulesList" class="rules-list">
                <p>Không có luật không hoạt động</p>
            </div>
        </section>

        <!-- Execution History -->
        <section class="card history-section">
            <h2>Lần thực thi gần đây</h2>
            <div id="executionHistory" class="history-list">
                <p>Không có lịch sử thực thi</p>
            </div>
        </section>
    </main>

    <script src="js/automation.js"></script>
</body>
</html>
