<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automation Rules - Smart Farm IoT</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/automation.css">
</head>
<body>
    <header>
        <h1>⚙️ Automation Rules</h1>
        <div class="header-controls">
            <div id="automationHeader"></div>
        </div>
    </header>

    <main class="automation-container">
        <!-- New Rule Section -->
        <section class="card new-rule-section">
            <h2>Create New Rule</h2>
            <form id="newRuleForm" class="rule-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="ruleName">Rule Name:</label>
                        <input type="text" id="ruleName" placeholder="e.g., Morning Irrigation" required>
                    </div>
                    <div class="form-group">
                        <label for="deviceSelect">Device:</label>
                        <select id="deviceSelect" required>
                            <option value="">Loading...</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="ruleType">Rule Type:</label>
                        <select id="ruleType" onchange="updateRuleTypeFields()" required>
                            <option value="">Select Type</option>
                            <option value="0">Schedule (Time-based)</option>
                            <option value="1">Threshold (Sensor-based)</option>
                            <option value="2">Timer (Fixed Duration)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="actuatorType">Actuator:</label>
                        <select id="actuatorType" required>
                            <option value="">Select Actuator</option>
                            <option value="0">Pump</option>
                            <option value="1">Fan</option>
                            <option value="2">Light</option>
                            <option value="3">Heater</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="action">Action:</label>
                        <select id="action" required>
                            <option value="ON">Turn ON</option>
                            <option value="OFF">Turn OFF</option>
                            <option value="PULSE">Pulse (1 min on/off)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="priority">Priority (1-10):</label>
                        <input type="number" id="priority" min="1" max="10" value="5" required>
                    </div>
                </div>

                <!-- Schedule Fields -->
                <div id="scheduleFields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="scheduleTime">Time of Day:</label>
                            <input type="time" id="scheduleTime">
                        </div>
                        <div class="form-group">
                            <label for="durationMinutes">Duration (minutes):</label>
                            <input type="number" id="durationMinutes" min="1" max="1440">
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label>Repeat On:</label>
                        <div class="days-select">
                            <label><input type="checkbox" name="days" value="Monday"> Monday</label>
                            <label><input type="checkbox" name="days" value="Tuesday"> Tuesday</label>
                            <label><input type="checkbox" name="days" value="Wednesday"> Wednesday</label>
                            <label><input type="checkbox" name="days" value="Thursday"> Thursday</label>
                            <label><input type="checkbox" name="days" value="Friday"> Friday</label>
                            <label><input type="checkbox" name="days" value="Saturday"> Saturday</label>
                            <label><input type="checkbox" name="days" value="Sunday"> Sunday</label>
                        </div>
                    </div>
                </div>

                <!-- Threshold Fields -->
                <div id="thresholdFields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conditionParameter">When Parameter:</label>
                            <select id="conditionParameter">
                                <option value="pH">pH</option>
                                <option value="TDS">TDS (Nutrients)</option>
                                <option value="Temperature">Water Temperature</option>
                                <option value="Humidity">Air Humidity</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conditionOperator">Becomes:</label>
                            <select id="conditionOperator">
                                <option value=">">&gt; (Greater than)</option>
                                <option value="<">&lt; (Less than)</option>
                                <option value=">=">&gt;= (Greater or equal)</option>
                                <option value="<=">&lt;= (Less or equal)</option>
                                <option value="==">=</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conditionValue">Value:</label>
                            <input type="number" id="conditionValue" placeholder="6.5" step="0.1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="durationMinutes2">Duration (minutes):</label>
                            <input type="number" id="durationMinutes2" min="1" max="1440" placeholder="30">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <button type="submit" class="btn-primary" style="width: 100%;">➕ Create Rule</button>
                </div>
            </form>
        </section>

        <!-- Active Rules Section -->
        <section class="card rules-section">
            <h2>Active Rules</h2>
            <div id="activeRulesList" class="rules-list">
                <p>Loading rules...</p>
            </div>
        </section>

        <!-- Inactive Rules Section -->
        <section class="card inactive-section">
            <h2>Inactive Rules</h2>
            <div id="inactiveRulesList" class="rules-list">
                <p>No inactive rules</p>
            </div>
        </section>

        <!-- Execution History -->
        <section class="card history-section">
            <h2>Recent Executions</h2>
            <div id="executionHistory" class="history-list">
                <p>No execution history</p>
            </div>
        </section>
    </main>

    <script src="js/automation.js"></script>
</body>
</html>
